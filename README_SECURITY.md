# セキュリティと運用に関する注意事項

## 1. 環境変数の管理

### 必須の対応
- **`.env`ファイルは絶対にGitにコミットしない**
- `.env.example`を参考に、本番環境用の`.env`ファイルを作成する
- 本番環境では環境変数管理サービス（AWS Systems Manager、Azure Key Vault等）の使用を推奨

### 環境変数の例
```bash
# 本番環境では必ず変更すること
OPENROUTER_API_KEY=your-production-api-key
SECRET_KEY=generate-a-secure-random-key-minimum-32-chars
ENVIRONMENT=production
```

## 2. データベースのセキュリティ

### SQLiteを使用する場合（現在の設定）
- データベースファイルのアクセス権限を適切に設定（600 or 640）
- 定期的なバックアップの実施
- バックアップファイルも適切に保護

### 本番環境での推奨
- PostgreSQLまたはMySQLへの移行を検討
- データベース接続の暗号化（SSL/TLS）
- 接続プーリングの適切な設定

## 3. ログ管理

### 現在の課題
- 一部でprint文が使用されている → ログライブラリへの統一が必要
- ログレベルの環境依存設定が不完全

### 推奨設定
```python
# 本番環境
log_level = logging.INFO

# 開発環境
log_level = logging.DEBUG
```

## 4. レート制限とリソース管理

### 現在の設定
- APIエンドポイントごとのレート制限が実装済み
- メッセージキャッシュのサイズ制限（デフォルト: 1000件）

### 追加検討事項
- リクエストボディサイズの制限
- ファイルアップロード機能を追加する場合のサイズ制限
- 同時接続数の制限

## 5. CORS設定

### 本番環境では必ず設定を見直す
```python
# 開発環境
CORS_ORIGINS=["http://localhost:5173"]

# 本番環境（例）
CORS_ORIGINS=["https://your-production-domain.com"]
```

## 6. 認証トークンの管理

### 現在の設定
- JWTトークンの有効期限: 30分（デフォルト）
- SECRET_KEYの最小長: 32文字

### セキュリティ強化
- 本番環境ではより長いSECRET_KEY（64文字以上）を推奨
- トークンのローテーション機能の実装を検討
- リフレッシュトークンの実装を検討

## 7. エラーハンドリング

### 注意事項
- スタックトレースは開発環境でのみ表示
- 本番環境では汎用的なエラーメッセージを返す
- 詳細なエラー情報はサーバー側のログに記録

## 8. 定期的な監査

### 推奨事項
- 依存関係の脆弱性スキャン（`pip-audit`等）
- ログの定期的な監査
- 異常なアクセスパターンの検知
- APIキーの定期的なローテーション